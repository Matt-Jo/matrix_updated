var ck=ck||{},global_autocomplete_init=!1;
ck.autocomplete=function(a,b,c){void 0==c?(c=b,b=a):void 0==c.$fields?c.$fields=[jQuery("#"+a)]:c.$fields.push(jQuery("#"+a));this.$autocomplete_fields=[];this.url=b;this.defaults={minimum_length:3,halt_request:function(){return!1},select_result:function(){},results_template:'{{#results}}<a href="#" class="entry" id="{{result_id}}">{{{result_label}}}</a>{{/results}}',ajax_obj:{type:"get",dataType:"json",data:{ajax:1},success:this.show_results.bind(this),error:this.result_error.bind(this)},auto_select_single:!0,
force_results_return:!1,display_handlers:{add_field:null,clear_results:null,show_results:null}};this.opts=c||{};this.input_timeout;this.init()};ck.autocomplete.styleset=null;
ck.autocomplete.styles=function(a){for(var b in a)if(a.hasOwnProperty(b))if(ck.autocomplete.styleset.add_selector(b),Array.isArray(a[b]))for(var c=0;c<a[b].length;c++)ck.autocomplete.styleset.add_stylestring(a[b][c]);else if("string"==typeof a[b])ck.autocomplete.styleset.add_stylestring(a[b]);else for(var d in a[b])a[b].hasOwnProperty(d)&&ck.autocomplete.styleset.add_style(d,a[b][d]);ck.autocomplete.styleset.render()};
ck.autocomplete.prototype.init=function(){for(var a in this.defaults)this.defaults.hasOwnProperty(a)&&void 0==this.opts[a]&&(this.opts[a]=this.defaults[a]);Mustache.parse(this.opts.results_template);global_autocomplete_init||(ck.autocomplete.styleset=new ck.styleset("autocomplete"),ck.autocomplete.styleset.add_selector(".autocomplete-group").add_style("display","inline-block"),ck.autocomplete.styleset.add_selector(".autocomplete-results").add_stylestring("display:none; background-color:#fff; border:1px solid #5cc; position:absolute; max-height:700px; overflow-y:auto; overflow-x:hidden; z-index:999;"),
ck.autocomplete.styleset.add_selector(".autocomplete-results .entry").add_stylestring("margin:0px; padding:4px 6px; font-size:.5vw; white-space:nowrap; border-bottom:1px solid #999; display:block; z-index:999;"),ck.autocomplete.styleset.add_selector(".autocomplete-results .entry:hover").add_stylestring("border-radius:3px; border-bottom-color:transparent; background:linear-gradient(#6ff, #7cf);"),ck.autocomplete.styleset.render(),jQuery("body").click(this.clear_results.bind(this,!0)),global_autocomplete_init=
!0);if(this.opts.$fields)for(a=0;a<this.opts.$fields.length;a++)this.add_field(this.opts.$fields[a])};
ck.autocomplete.prototype.add_field=function(a){if(this.opts.display_handlers.add_field)this.opts.display_handlers.add_field.call(this,a);else{var b=this;a.each(function(){jQuery(this).addClass("autocomplete-field");this.$autocomplete_group=jQuery("<div></div>").addClass("autocomplete-group");this.$autocomplete_results=jQuery("<div></div>").addClass("autocomplete-results");void 0!=b.opts.autocomplete_results_class&&this.$autocomplete_results.addClass(b.opts.autocomplete_results_class);this.$autocomplete_value=
null;void 0!=b.opts.hidden_value_field?this.$autocomplete_value=jQuery("#"+b.opts.hidden_value_field).addClass("autocomplete-value"):jQuery(this).attr("data-autocomplete-value-field")&&(this.$autocomplete_value=jQuery("#"+jQuery(this).attr("data-autocomplete-value-field")).addClass("autocomplete-value"));this.$autocomplete_group.insertAfter(jQuery(this));jQuery(this).appendTo(this.$autocomplete_group);this.$autocomplete_group.append(this.$autocomplete_results);this.$autocomplete_value&&this.$autocomplete_group.append(this.$autocomplete_value);
jQuery(this).attr("autocomplete","off").keyup(function(){var a=this;b.input_timeout&&clearTimeout(b.input_timeout);b.input_timeout=setTimeout(function(){b.request.call(b,a)},150)});b.opts.request_onclick&&jQuery(this).click(function(a){a.stopPropagation();""==jQuery(this).val()&&b.request.call(b,this)});b.$autocomplete_fields.push(jQuery(this))})}};ck.autocomplete.prototype.clear_results=function(a){this.opts.display_handlers.clear_results?this.opts.display_handlers.clear_results.call(this,a):jQuery(".autocomplete-results").hide().html("")};
ck.autocomplete.prototype.halt_request=function(a){return this.opts.halt_request(a)?!0:a.length<this.opts.minimum_length?!0:!1};
ck.autocomplete.prototype.request=function(a){if(this.opts.local_results)this.local_request(a);else{this.clear_results(!1);this.autocomplete_request_element=a;var b=jQuery(a).val(),c=this.opts.autocomplete_field_name||jQuery(a).attr("name");if(!this.halt_request(b)){this.opts.preprocess&&this.opts.preprocess(b);var d=jQuery.extend({},this.opts.ajax_obj);d.url=this.url;d.data.action=this.opts.autocomplete_action||"autocomplete";d.data[c]=b;this.opts.process_additional_fields&&(d.data=this.opts.process_additional_fields.call(a,
d.data));if(this.opts.force_results_return){if(void 0==this.$autocomplete_request&&(this.$autocomplete_request={}),void 0!=this.$autocomplete_request[b])return}else this.$autocomplete_request&&this.$autocomplete_request.abort();this.$autocomplete_request=jQuery.ajax(d)}}};
ck.autocomplete.prototype.local_request=function(a){this.clear_results(!1);this.autocomplete_request_element=a;var b=jQuery(a).val();a=this.opts.autocomplete_field_name||jQuery(a).attr("name");if(!this.halt_request(b)){this.opts.preprocess&&this.opts.preprocess(b);var c={};c.action=this.opts.autocomplete_action||"autocomplete";c[a]=b;this.opts.process_additional_fields&&(c=this.opts.process_additional_fields(c));b=this.opts.local_results(c);this.show_results.call(this,b)}};
ck.autocomplete.prototype.show_results=function(a,b,c){if(this.opts.display_handlers.show_results)this.opts.display_handlers.show_results.call(this,a,b,c);else if(null!=a&&(this.clear_results(!1),0!=a.results.length)){if(this.opts.auto_select_single&&1==a.results.length)return this.select_result(a.results[0]);this.autocomplete_request_element.$autocomplete_results.append(jQuery(Mustache.render(this.opts.results_template,a)));var d=this;setTimeout(function(){for(var b=0;b<a.results.length;b++)jQuery("#"+
a.results[b].result_id).click(d.select_result.bind(d,a.results[b]));d.autocomplete_request_element.$autocomplete_results.show()},20)}};ck.autocomplete.prototype.select_result=function(a,b){b&&b.preventDefault();jQuery(this.autocomplete_request_element).val(a.field_value);this.autocomplete_request_element.$autocomplete_value&&this.autocomplete_request_element.$autocomplete_value.val(a.value);this.opts.select_result.call(this,a);this.clear_results(!1)};ck.autocomplete.prototype.result_error=function(){};